<!DOCTYPE html>
<html lang="en"><head><title>Nginx configuration for AngularJS cloud project with Apiary - The Egel's Blog</title><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link href="http://egel.pl/extras/favicon.png" rel="icon"><link rel="canonical" href="http://egel.pl/nginx-configuration-for-angularjs-cloud-project-with-apiary.html"><meta name="author" content="Maciej Sypień"><meta name="keywords" content="angularjs,nginx,apiary,frontend"><meta name="description" content="![Logo of Sublime Text 3]({filename}/images/nginx_logo.png) --> Recently I have been working on some cloud project with my coworkers. We used AngularJS as frontend framework and Apiary as a backend bridge for RESTful API, while the real backend was being built. The main gole for proper nginx configuration was to serve *.example.dev domains, but with some …"><meta property="og:site_name" content="The Egel's Blog"><meta property="og:type" content="article"><meta property="og:title" content="Nginx configuration for AngularJS cloud project with Apiary"><meta property="og:url" content="http://egel.pl/nginx-configuration-for-angularjs-cloud-project-with-apiary.html"><meta property="og:description" content="![Logo of Sublime Text 3]({filename}/images/nginx_logo.png) --> Recently I have been working on some cloud project with my coworkers. We used AngularJS as frontend framework and Apiary as a backend bridge for RESTful API, while the real backend was being built. The main gole for proper nginx configuration was to serve *.example.dev domains, but with some …"><meta property="article:published_time" content="2016-04-13"><meta property="article:section" content="Diary"><meta property="article:tag" content="angularjs"><meta property="article:tag" content="nginx"><meta property="article:tag" content="apiary"><meta property="article:tag" content="frontend"><meta property="article:author" content="Maciej Sypień"><link rel="stylesheet" href="http://egel.pl/theme/css/egelance_pelican_theme-official-v2.0.0.css" type="text/css"><link href="http://egel.pl/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="The Egel's Blog ATOM Feed"></head><body><nav class="navbar navbar-default"><div class="container-fluid"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="http://egel.pl/" class="navbar-brand"> The Egel's Blog </a></div><div id="navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="http://egel.pl">Home</a></li><li><a href="http://egel.pl/pages/about-me.html">About me</a></li><li><a href="http://egel.pl/reading-list.html">Reading list</a></li><li><a href="http://egel.pl/archives.html">Archives</a></li></ul></div></div></nav><header class="intro-header"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="site-heading"><h1>Do more in less time</h1><hr class="small"><span class="subheading">Simplicity and clarity of the implementation</span></div></div></div></div></header><div class="container"><div class="row"><div class="col-md-3 sidebar sidebar-tablet"><div class="aboutme"><h4>About the author</h4><img class="avatar thumbnail" src="https://secure.gravatar.com/avatar/4d66c5a2d6be57e7cb9bdef200417b4d?s=200"><p> Programmer, soundtracks enthusiast, astrophysics fan. Occasionally hacking this blog with new articles. </p></div><ul class="list-group social-list"><li><ul class="list-inline" id="social"><li><a href="https://twitter.com/MaciejSypien" target="_blank"><i class="fa fa-twitter-square fa-lg"></i></a></li><li><a href="https://github.com/egel" target="_blank"><i class="fa fa-github-square fa-lg"></i></a></li><li><a href="https://www.linkedin.com/in/maciejsypien" target="_blank"><i class="fa fa-linkedin-square fa-lg"></i></a></li><li><a href="http://egel.pl/feeds/all.atom.xml" title="Feed atom" target="_blank"><i class="fa fa-lg fa-rss-square"></i></a></li></ul></li></ul><section><ul class="list-group"><li><h4>Categories</h4><ul id="categories"><li><a href="http://egel.pl/category/diary.html">Diary</a></li><li><a href="http://egel.pl/category/discovery.html">Discovery</a></li><li><a href="http://egel.pl/category/how-to.html">How to</a></li><li><a href="http://egel.pl/category/self-improvement.html">Self improvement</a></li></ul></li><li><h4><span class="icon-label">Tags</span></h4><ul class="list-inline tagcloud" id="tags"><li class="tag-4"><a href="http://egel.pl/tag/angularjs.html">angularjs</a></li><li class="tag-4"><a href="http://egel.pl/tag/apache.html">apache</a></li><li class="tag-4"><a href="http://egel.pl/tag/apiary.html">apiary</a></li><li class="tag-4"><a href="http://egel.pl/tag/arch.html">arch</a></li><li class="tag-2"><a href="http://egel.pl/tag/console.html">console</a></li><li class="tag-4"><a href="http://egel.pl/tag/domains.html">domains</a></li><li class="tag-2"><a href="http://egel.pl/tag/frontend.html">frontend</a></li><li class="tag-2"><a href="http://egel.pl/tag/git.html">git</a></li><li class="tag-4"><a href="http://egel.pl/tag/gui.html">gui</a></li><li class="tag-4"><a href="http://egel.pl/tag/install.html">install</a></li><li class="tag-2"><a href="http://egel.pl/tag/latex.html">latex</a></li><li class="tag-0"><a href="http://egel.pl/tag/linux.html">linux</a></li><li class="tag-4"><a href="http://egel.pl/tag/mysql.html">mysql</a></li><li class="tag-2"><a href="http://egel.pl/tag/nginx.html">nginx</a></li><li class="tag-4"><a href="http://egel.pl/tag/osx.html">osx</a></li><li class="tag-2"><a href="http://egel.pl/tag/pelican.html">pelican</a></li><li class="tag-4"><a href="http://egel.pl/tag/php.html">php</a></li><li class="tag-4"><a href="http://egel.pl/tag/server.html">server</a></li><li class="tag-4"><a href="http://egel.pl/tag/source-files.html">source-files</a></li><li class="tag-4"><a href="http://egel.pl/tag/sublime.html">sublime</a></li><li class="tag-1"><a href="http://egel.pl/tag/terminal.html">terminal</a></li><li class="tag-2"><a href="http://egel.pl/tag/text-editor.html">text-editor</a></li><li class="tag-4"><a href="http://egel.pl/tag/ubuntu.html">ubuntu</a></li><li class="tag-2"><a href="http://egel.pl/tag/university.html">university</a></li><li class="tag-2"><a href="http://egel.pl/tag/vim.html">vim</a></li><li class="tag-2"><a href="http://egel.pl/tag/wordpress.html">wordpress</a></li></ul></li></ul></section></div><div class="col-md-9"><section id="content" class="single-article"><article><header class="page-header"><div class="post-info"><span class="text-muted article-published"><time datetime="2016-04-13T12:44:00+02:00">Apr 13, 2016</time></span><span class="text-muted article-category">&middot; Category</span><a class="article-category-name" href="http://egel.pl/category/diary.html">Diary</a><span class="text-muted tags-dot">&middot;</span><a class="single-tag tag-1" href="http://egel.pl/tag/angularjs.html" title="angularjs">angularjs</a><a class="single-tag tag-2" href="http://egel.pl/tag/nginx.html" title="nginx">nginx</a><a class="single-tag tag-3" href="http://egel.pl/tag/apiary.html" title="apiary">apiary</a><a class="single-tag tag-4" href="http://egel.pl/tag/frontend.html" title="frontend">frontend</a></div><h1> Nginx configuration for AngularJS cloud project with Apiary </h1></header><div class="entry-content"><p>Recently I have been working on some cloud project with my coworkers. We used <a href="https://angularjs.org/">AngularJS</a> as frontend framework and <a href="https://apiary.io/">Apiary</a> as a backend bridge for RESTful API, while the real backend was being built.</p><p>The main gole for proper nginx configuration was to serve <code>*.example.dev</code> domains, but with some exceptions (restrictions) for subdomains:</p><ul><li><code>www</code> subdomain as a legacy restriction</li><li><code>api</code> subdomain reserved for final REST API</li><li><code>tests</code> this subdomain (for my purpose only) provides easy URL to code coverage with unit tests</li></ul><blockquote><p>I use <code>dev</code> domain only for on my local machine only. Feel free to change it on whatever name you like.</p></blockquote><p>While building frontend application I have made some basic nginx configuration and it looks like this snippet presented at the bottom.</p><blockquote><p>It might be important for Readers. We have decided to split application for two separate projects, due to AngularJS have problems with support of multiple subdomains. Finally one of our application serve subdomains <code>&lt;variable&gt;.example.dev</code> and other serve bacis domain <code>example.dev</code>.</p></blockquote><p>This configuration provides 5 servers:</p><ul><li>First one is for frontend application, which may support organizations with some exceptions for <code>api</code>, <code>tests</code> and <code>www</code> (ex.: <code>companyname.example.dev</code>).</li><li>Second for legacy domain <code>www</code> redirect.</li><li>The third is for frontend aplication which may support only basic domain (ex.: <code>example.dev</code>).</li><li>Next one is for REST backend domain redirect provided by apiary.</li><li>The Last one provides easy access for auto generated code coverage for fronted app.</li></ul><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">server</span> <span class="p">{</span>
  <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
  <span class="kn">server_name</span> <span class="p">~</span><span class="sr">^(?:(?!www)(?!api)(?!tests))(.*)\.example\.dev$;</span>
  <span class="s">access_log</span> <span class="s">/tmp/subdomains.example.dev.log</span><span class="p">;</span>
  <span class="kn">error_log</span>  <span class="s">/tmp/subdomains.example.dev.error.log</span><span class="p">;</span>

  <span class="kn">client_max_body_size</span> <span class="s">100M</span><span class="p">;</span>

  <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
    <span class="kn">add_header</span> <span class="s">&#39;Access-Control-Allow-Origin&#39;</span> <span class="s">&#39;*&#39;</span><span class="p">;</span>
    <span class="kn">root</span> <span class="s">&#39;/ABSOLUTE_PATH_TO_WORKING_DIR/example-subdomain-frontend/build&#39;</span><span class="p">;</span>
    <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri/</span> <span class="s">/index.html</span> <span class="p">=</span><span class="mi">404</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">server</span> <span class="p">{</span>
  <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
  <span class="kn">server_name</span> <span class="s">www.example.dev</span><span class="p">;</span>
  <span class="kn">return</span> <span class="mi">301</span> <span class="nv">$scheme://exampe.dev$request_uri</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">server</span> <span class="p">{</span>
  <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
  <span class="kn">server_name</span> <span class="s">example.dev</span><span class="p">;</span>
  <span class="kn">access_log</span> <span class="s">/tmp/example.dev.log</span><span class="p">;</span>
  <span class="kn">error_log</span>  <span class="s">/tmp/example.dev.error.log</span><span class="p">;</span>

  <span class="kn">client_max_body_size</span> <span class="s">100M</span><span class="p">;</span>

  <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
    <span class="kn">add_header</span> <span class="s">&#39;Access-Control-Allow-Origin&#39;</span> <span class="s">&#39;*&#39;</span><span class="p">;</span>
    <span class="kn">root</span> <span class="s">&#39;/ABSOLUTE_PATH_TO_WORKING_DIR/example-domain-frontend/build&#39;</span><span class="p">;</span>
    <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri/</span> <span class="s">/index.html</span> <span class="p">=</span><span class="mi">404</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">server</span> <span class="p">{</span>
  <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
  <span class="kn">server_name</span> <span class="s">api.example.dev</span><span class="p">;</span>

  <span class="kn">access_log</span> <span class="s">/tmp/api.example.dev.log</span><span class="p">;</span>
  <span class="kn">error_log</span>  <span class="s">/tmp/api.example.dev.error.log</span><span class="p">;</span>

  <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
    <span class="kn">add_header</span> <span class="s">&#39;Access-Control-Allow-Credentials&#39;</span> <span class="s">&#39;true&#39;</span><span class="p">;</span>
    <span class="kn">add_header</span> <span class="s">&#39;Access-Control-Allow-Methods&#39;</span> <span class="s">&#39;GET,</span> <span class="s">POST,</span> <span class="s">PUT,</span> <span class="s">DELETE,</span> <span class="s">OPTIONS&#39;</span><span class="p">;</span>
    <span class="kn">add_header</span> <span class="s">&#39;Access-Control-Allow-Headers&#39;</span> <span class="s">&#39;DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type&#39;</span><span class="p">;</span>

    <span class="kn">proxy_pass</span> <span class="s">http://private-ABCDE-example.apiary-mock.com</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="k">server</span> <span class="p">{</span>
  <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
  <span class="kn">server_name</span> <span class="s">tests.example.dev</span><span class="p">;</span>

  <span class="kn">client_max_body_size</span> <span class="s">100M</span><span class="p">;</span>

  <span class="kn">root</span> <span class="s">&quot;/ABSOLUTE_PATH_TO_WORKING_DIR/example-subdomain-frontend/tests/test-coverage/PhantomJS</span> <span class="mi">2</span><span class="s">.1.1</span> <span class="s">(Mac</span> <span class="s">OS</span> <span class="s">X</span> <span class="mi">0</span><span class="s">.0.0)&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></td></tr></table></div><section class="well" id="related-posts"><h4>Few related posts:</h4><ul><li><a href="http://egel.pl/how-to-improve-nginx-setup-on-mac-osx.html">How to improve nginx setup on Mac OSX</a></li><li><a href="http://egel.pl/install-and-configure-dnsmasq-on-linux.html">Install and configure dnsmasq on Linux</a></li></ul></section><hr><section class="comments" id="comments"><h2>Comments</h2><div id="disqus_thread"></div><script type="text/javascript">
      var disqus_shortname = "egel";
      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
        var s = document.createElement('script');
        s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></section></article></section></div></div></div><div class="container sidebar-phone"><div class="row"><div class="col-xs-12 col-sm-12 sidebar"><div class="aboutme"><h4>About the author</h4><img class="avatar thumbnail" src="https://secure.gravatar.com/avatar/4d66c5a2d6be57e7cb9bdef200417b4d?s=200"><p> Programmer, soundtracks enthusiast, astrophysics fan. Occasionally hacking this blog with new articles. </p></div><ul class="list-group social-list"><li><ul class="list-inline" id="social"><li><a href="https://twitter.com/MaciejSypien" target="_blank"><i class="fa fa-twitter-square fa-lg"></i></a></li><li><a href="https://github.com/egel" target="_blank"><i class="fa fa-github-square fa-lg"></i></a></li><li><a href="https://www.linkedin.com/in/maciejsypien" target="_blank"><i class="fa fa-linkedin-square fa-lg"></i></a></li><li><a href="http://egel.pl/feeds/all.atom.xml" title="Feed atom" target="_blank"><i class="fa fa-lg fa-rss-square"></i></a></li></ul></li></ul><section><ul class="list-group"><li><h4>Categories</h4><ul id="categories"><li><a href="http://egel.pl/category/diary.html">Diary</a></li><li><a href="http://egel.pl/category/discovery.html">Discovery</a></li><li><a href="http://egel.pl/category/how-to.html">How to</a></li><li><a href="http://egel.pl/category/self-improvement.html">Self improvement</a></li></ul></li><li><h4><span class="icon-label">Tags</span></h4><ul class="list-inline tagcloud" id="tags"><li class="tag-4"><a href="http://egel.pl/tag/angularjs.html">angularjs</a></li><li class="tag-4"><a href="http://egel.pl/tag/apache.html">apache</a></li><li class="tag-4"><a href="http://egel.pl/tag/apiary.html">apiary</a></li><li class="tag-4"><a href="http://egel.pl/tag/arch.html">arch</a></li><li class="tag-2"><a href="http://egel.pl/tag/console.html">console</a></li><li class="tag-4"><a href="http://egel.pl/tag/domains.html">domains</a></li><li class="tag-2"><a href="http://egel.pl/tag/frontend.html">frontend</a></li><li class="tag-2"><a href="http://egel.pl/tag/git.html">git</a></li><li class="tag-4"><a href="http://egel.pl/tag/gui.html">gui</a></li><li class="tag-4"><a href="http://egel.pl/tag/install.html">install</a></li><li class="tag-2"><a href="http://egel.pl/tag/latex.html">latex</a></li><li class="tag-0"><a href="http://egel.pl/tag/linux.html">linux</a></li><li class="tag-4"><a href="http://egel.pl/tag/mysql.html">mysql</a></li><li class="tag-2"><a href="http://egel.pl/tag/nginx.html">nginx</a></li><li class="tag-4"><a href="http://egel.pl/tag/osx.html">osx</a></li><li class="tag-2"><a href="http://egel.pl/tag/pelican.html">pelican</a></li><li class="tag-4"><a href="http://egel.pl/tag/php.html">php</a></li><li class="tag-4"><a href="http://egel.pl/tag/server.html">server</a></li><li class="tag-4"><a href="http://egel.pl/tag/source-files.html">source-files</a></li><li class="tag-4"><a href="http://egel.pl/tag/sublime.html">sublime</a></li><li class="tag-1"><a href="http://egel.pl/tag/terminal.html">terminal</a></li><li class="tag-2"><a href="http://egel.pl/tag/text-editor.html">text-editor</a></li><li class="tag-4"><a href="http://egel.pl/tag/ubuntu.html">ubuntu</a></li><li class="tag-2"><a href="http://egel.pl/tag/university.html">university</a></li><li class="tag-2"><a href="http://egel.pl/tag/vim.html">vim</a></li><li class="tag-2"><a href="http://egel.pl/tag/wordpress.html">wordpress</a></li></ul></li></ul></section></div></div></div><footer class="footer"><div class="container"><div class="row"><div class="col-xs-12"><a href="#" class="scrollToTop"><i class="fa fa-arrow-up"></i></a><p>&copy; Copyright 2017 &middot; The Egel's Blog &middot; The <a href="https://en.wikipedia.org/wiki/KISS_principle" title="Keep it stupid simple" target="_blank">KISS</a> Principle &middot; Build with <a href="http://docs.getpelican.com/" target="_blank">pelican</a>. </p></div></div></div></footer><script src="http://egel.pl/theme/js/egelance_pelican_theme-v2.0.0.js"></script><script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-26456669-2', 'auto');
      ga('send', 'pageview');
    </script><script type="text/javascript">var addthis_config = {"data_track_addressbar": true};</script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=True"></script></div></div></body></html>