<!DOCTYPE html>
<html lang="en"><head><title>Git push guardian - The Egel's Blog</title><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link href="./extras/favicon.png" rel="icon"><link rel="canonical" href="./git-push-guardian.html"><meta name="author" content="Maciej Sypień"><meta name="keywords" content="git,terminal"><meta name="description" content="![LaTeX logo]({filename}/images/git_logo-mini.png) --> Recently I wondering how to improve my workflow with Git. I came across the Web and found some article which pointed on git hooks and were introduced in version 1.8.2. That cool feature, allows to execute some code before/after some actions made in git. My team have …"><meta property="og:site_name" content="The Egel's Blog"><meta property="og:type" content="article"><meta property="og:title" content="Git push guardian"><meta property="og:url" content="./git-push-guardian.html"><meta property="og:description" content="![LaTeX logo]({filename}/images/git_logo-mini.png) --> Recently I wondering how to improve my workflow with Git. I came across the Web and found some article which pointed on git hooks and were introduced in version 1.8.2. That cool feature, allows to execute some code before/after some actions made in git. My team have …"><meta property="article:published_time" content="2016-05-16"><meta property="article:section" content="Self improvement"><meta property="article:tag" content="git"><meta property="article:tag" content="terminal"><meta property="article:author" content="Maciej Sypień"><link rel="stylesheet" href="./theme/css/egelance_pelican_theme-official-v2.0.0.css" type="text/css"><link href="./feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="The Egel's Blog ATOM Feed"></head><body><nav class="navbar navbar-default"><div class="container-fluid"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="./" class="navbar-brand"> The Egel's Blog </a></div><div id="navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href=".">Home</a></li><li><a href="./pages/about-me.html">About me</a></li><li><a href="./reading-list.html">Reading list</a></li><li><a href="./archives.html">Archives</a></li></ul></div></div></nav><header class="intro-header"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="site-heading"><h1>Do more in less time</h1><hr class="small"><span class="subheading">Simplicity and clarity of the implementation</span></div></div></div></div></header><div class="container"><div class="row"><div class="col-md-3 sidebar sidebar-tablet"><div class="aboutme"><h4>About the author</h4><img class="avatar thumbnail" src="https://secure.gravatar.com/avatar/4d66c5a2d6be57e7cb9bdef200417b4d?s=200"><p> Programmer, soundtracks enthusiast, astrophysics fan. Occasionally hacking this blog with new articles. </p></div><ul class="list-group social-list"><li><ul class="list-inline" id="social"><li><a href="https://twitter.com/MaciejSypien" target="_blank"><i class="fa fa-twitter-square fa-lg"></i></a></li><li><a href="https://github.com/egel" target="_blank"><i class="fa fa-github-square fa-lg"></i></a></li><li><a href="https://www.linkedin.com/in/maciejsypien" target="_blank"><i class="fa fa-linkedin-square fa-lg"></i></a></li><li><a href="./feeds/all.atom.xml" title="Feed atom" target="_blank"><i class="fa fa-lg fa-rss-square"></i></a></li></ul></li></ul><section><ul class="list-group"><li><h4>Categories</h4><ul id="categories"><li><a href="./category/diary.html">Diary</a></li><li><a href="./category/discovery.html">Discovery</a></li><li><a href="./category/how-to.html">How to</a></li><li><a href="./category/self-improvement.html">Self improvement</a></li></ul></li><li><h4><span class="icon-label">Tags</span></h4><ul class="list-inline tagcloud" id="tags"><li class="tag-4"><a href="./tag/angularjs.html">angularjs</a></li><li class="tag-4"><a href="./tag/apache.html">apache</a></li><li class="tag-4"><a href="./tag/apiary.html">apiary</a></li><li class="tag-4"><a href="./tag/arch.html">arch</a></li><li class="tag-2"><a href="./tag/console.html">console</a></li><li class="tag-4"><a href="./tag/domains.html">domains</a></li><li class="tag-2"><a href="./tag/frontend.html">frontend</a></li><li class="tag-2"><a href="./tag/git.html">git</a></li><li class="tag-4"><a href="./tag/gui.html">gui</a></li><li class="tag-2"><a href="./tag/install.html">install</a></li><li class="tag-1"><a href="./tag/latex.html">latex</a></li><li class="tag-1"><a href="./tag/linux.html">linux</a></li><li class="tag-4"><a href="./tag/mysql.html">mysql</a></li><li class="tag-2"><a href="./tag/nginx.html">nginx</a></li><li class="tag-4"><a href="./tag/osx.html">osx</a></li><li class="tag-2"><a href="./tag/pelican.html">pelican</a></li><li class="tag-4"><a href="./tag/php.html">php</a></li><li class="tag-4"><a href="./tag/server.html">server</a></li><li class="tag-4"><a href="./tag/sublime.html">sublime</a></li><li class="tag-1"><a href="./tag/terminal.html">terminal</a></li><li class="tag-1"><a href="./tag/text-editor.html">text-editor</a></li><li class="tag-1"><a href="./tag/university.html">university</a></li><li class="tag-4"><a href="./tag/vim.html">vim</a></li><li class="tag-2"><a href="./tag/wordpress.html">wordpress</a></li></ul></li></ul></section></div><div class="col-md-9"><section id="content" class="single-article"><article><header class="page-header"><div class="post-info"><span class="text-muted article-published"><time datetime="2016-05-16T00:00:00+02:00">May 16, 2016</time></span><span class="text-muted article-category">&middot; Category</span><a class="article-category-name" href="./category/self-improvement.html">Self improvement</a><span class="text-muted tags-dot">&middot;</span><a class="single-tag tag-1" href="./tag/git.html" title="git">git</a><a class="single-tag tag-2" href="./tag/terminal.html" title="terminal">terminal</a></div><h1> Git push guardian </h1></header><div class="entry-content"><p>Recently I wondering how to improve my workflow with Git. I came across the Web and found some article which pointed on git hooks and were introduced in version 1.8.2.</p><p>That cool feature, allows to execute some code before/after some actions made in git. My team have decided that we will compleate our tasks into feature branches, and to do it so, we mark our main branches: <code>master</code>, <code>stage</code> and <code>develop</code> as protected. That means, only users with master access or grater (for repository), can push directly to this branches. I have that privilage, but switching between so many branches, checking, pushing, checking, pushing - this all can confuse a mind for a second.</p><p>Than I realize, if there any available option to prevent important actions (like push) on those protected branches. And puff...there git hooks came in on the stage.</p><h2>Guardian Script</h2><p>With some examples on web and git documentation, I wrote simple git <strong>pre-push</strong> script that will check on which branch you are in and it will ask you "Are you intend to push?" to those protected branches.</p><p>Full script are available into my gist on github <a href="https://gist.github.com/egel/2058f19cf78df84ade741b7a77a38006">HERE - git pre-push</a>, but I also paste this snippet here, to make the article complete.</p><h3>Implemented features:</h3><ul><li>Array with protected branches (easy to maintain)</li><li>Base terminal colors to improve visibility</li><li>Question that only work when confirm with enter (time to wonder it is correct action)</li><li>Default value of question set to <code>No</code></li><li>Message of committed action</li></ul><h3>Things which may be improved in the future:</h3><ul><li>Download list of protected branches direct from repository</li><li>Add support for some popular flags like: <code>--force</code></li></ul><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1"># General colors</span>
<span class="nv">black</span><span class="o">=</span><span class="s1">&#39;\x1B[0;30m&#39;</span>
<span class="nv">red</span><span class="o">=</span><span class="s1">&#39;\x1B[0;31m&#39;</span>
<span class="nv">green</span><span class="o">=</span><span class="s1">&#39;\x1B[0;32m&#39;</span> <span class="c1"># &#39;\e[1;32m&#39; is too bright for white bg.</span>
<span class="nv">blue</span><span class="o">=</span><span class="s1">&#39;\x1B[1;34m&#39;</span>
<span class="nv">yellow</span><span class="o">=</span><span class="s1">&#39;\x1B[0;33m&#39;</span>
<span class="nv">purple</span><span class="o">=</span><span class="s1">&#39;\x1B[1;35m&#39;</span>
<span class="nv">cyan</span><span class="o">=</span><span class="s1">&#39;\x1B[0;36m&#39;</span>
<span class="nv">endColor</span><span class="o">=</span><span class="s1">&#39;\x1B[0m&#39;</span>


<span class="nv">protected_branches</span><span class="o">=(</span> master develop <span class="o">)</span>
<span class="nv">current_branch</span><span class="o">=</span><span class="k">$(</span>git symbolic-ref HEAD <span class="p">|</span> sed -e <span class="s1">&#39;s,.*/\(.*\),\1,&#39;</span><span class="k">)</span>

<span class="k">for</span> i in <span class="s2">&quot;</span><span class="si">${</span><span class="nv">protected_branches</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">do</span>
  <span class="k">if</span> <span class="o">[</span> <span class="si">${</span><span class="nv">i</span><span class="si">}</span> <span class="o">==</span> <span class="si">${</span><span class="nv">current_branch</span><span class="si">}</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> -en <span class="s2">&quot;</span><span class="si">${</span><span class="nv">yellow</span><span class="si">}</span><span class="s2">[Git pre-push]</span><span class="si">${</span><span class="nv">endColor</span><span class="si">}</span><span class="s2"> You&#39;re about to push to </span><span class="si">${</span><span class="nv">red</span><span class="si">}${</span><span class="nv">i</span><span class="si">}${</span><span class="nv">endColor</span><span class="si">}</span><span class="s2">, is that what you intended?&quot;</span>
    <span class="nb">read</span> -p <span class="s2">&quot; [y/N] &quot;</span> -r &lt; /dev/tty
    <span class="k">if</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">REPLY</span><span class="si">}</span> <span class="p">|</span> egrep -E <span class="s1">&#39;^[yY]$&#39;</span> &gt; /dev/null
    <span class="k">then</span>
      <span class="nb">echo</span> -e <span class="s2">&quot;Continue of pushing to </span><span class="si">${</span><span class="nv">red</span><span class="si">}${</span><span class="nv">i</span><span class="si">}${</span><span class="nv">endColor</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="nb">exit</span> <span class="m">0</span> <span class="c1"># push will execute</span>
    <span class="k">fi</span>
    <span class="nb">echo</span> -en <span class="s2">&quot;Abort pushing to </span><span class="si">${</span><span class="nv">red</span><span class="si">}${</span><span class="nv">i</span><span class="si">}${</span><span class="nv">endColor</span><span class="si">}</span><span class="s2">\n&quot;</span>
    <span class="nb">exit</span> <span class="m">1</span> <span class="c1"># push will not execute</span>
  <span class="k">fi</span>
<span class="k">done</span>
<span class="nb">exit</span> <span class="m">0</span> <span class="c1"># push will execute when won&#39;t match protected_branches</span>
</pre></div></td></tr></table><h2>How to use it?</h2><p>You need to enter into your git project <code>~/workspace/&lt;your_project&gt;</code>. In this folder you should have a <code>.git/hooks</code> directory (if not you have poprably git older then 1.8.2). Then save above file as <code>~/workspace/&lt;your_project&gt;/.git/hooks/pre-push</code>.</p><blockquote><p>Do not forget to add <code>chmod +x pre-push</code>.</p></blockquote><p>Now every time you will push to one of <code>protected_branches</code> listed into the file, Git will ask you is that was your intend action. For git masters, this little trick can save a day ;)</p></div><section class="well" id="related-posts"><h4>Few related posts:</h4><ul><li><a href="./git-pre-commit-email-blocker.html">Git pre commit email blocker</a></li><li><a href="./tasting-of-arch-linux.html">Tasting of Arch Linux</a></li><li><a href="./install-the-latest-nvidia-drivers-for-linux.html">Install the latest nVidia drivers for Linux</a></li></ul></section></article></section></div></div></div><div class="container sidebar-phone"><div class="row"><div class="col-xs-12 col-sm-12 sidebar"><div class="aboutme"><h4>About the author</h4><img class="avatar thumbnail" src="https://secure.gravatar.com/avatar/4d66c5a2d6be57e7cb9bdef200417b4d?s=200"><p> Programmer, soundtracks enthusiast, astrophysics fan. Occasionally hacking this blog with new articles. </p></div><ul class="list-group social-list"><li><ul class="list-inline" id="social"><li><a href="https://twitter.com/MaciejSypien" target="_blank"><i class="fa fa-twitter-square fa-lg"></i></a></li><li><a href="https://github.com/egel" target="_blank"><i class="fa fa-github-square fa-lg"></i></a></li><li><a href="https://www.linkedin.com/in/maciejsypien" target="_blank"><i class="fa fa-linkedin-square fa-lg"></i></a></li><li><a href="./feeds/all.atom.xml" title="Feed atom" target="_blank"><i class="fa fa-lg fa-rss-square"></i></a></li></ul></li></ul><section><ul class="list-group"><li><h4>Categories</h4><ul id="categories"><li><a href="./category/diary.html">Diary</a></li><li><a href="./category/discovery.html">Discovery</a></li><li><a href="./category/how-to.html">How to</a></li><li><a href="./category/self-improvement.html">Self improvement</a></li></ul></li><li><h4><span class="icon-label">Tags</span></h4><ul class="list-inline tagcloud" id="tags"><li class="tag-4"><a href="./tag/angularjs.html">angularjs</a></li><li class="tag-4"><a href="./tag/apache.html">apache</a></li><li class="tag-4"><a href="./tag/apiary.html">apiary</a></li><li class="tag-4"><a href="./tag/arch.html">arch</a></li><li class="tag-2"><a href="./tag/console.html">console</a></li><li class="tag-4"><a href="./tag/domains.html">domains</a></li><li class="tag-2"><a href="./tag/frontend.html">frontend</a></li><li class="tag-2"><a href="./tag/git.html">git</a></li><li class="tag-4"><a href="./tag/gui.html">gui</a></li><li class="tag-2"><a href="./tag/install.html">install</a></li><li class="tag-1"><a href="./tag/latex.html">latex</a></li><li class="tag-1"><a href="./tag/linux.html">linux</a></li><li class="tag-4"><a href="./tag/mysql.html">mysql</a></li><li class="tag-2"><a href="./tag/nginx.html">nginx</a></li><li class="tag-4"><a href="./tag/osx.html">osx</a></li><li class="tag-2"><a href="./tag/pelican.html">pelican</a></li><li class="tag-4"><a href="./tag/php.html">php</a></li><li class="tag-4"><a href="./tag/server.html">server</a></li><li class="tag-4"><a href="./tag/sublime.html">sublime</a></li><li class="tag-1"><a href="./tag/terminal.html">terminal</a></li><li class="tag-1"><a href="./tag/text-editor.html">text-editor</a></li><li class="tag-1"><a href="./tag/university.html">university</a></li><li class="tag-4"><a href="./tag/vim.html">vim</a></li><li class="tag-2"><a href="./tag/wordpress.html">wordpress</a></li></ul></li></ul></section></div></div></div><footer class="footer"><div class="container"><div class="row"><div class="col-xs-12"><a href="#" class="scrollToTop"><i class="fa fa-arrow-up"></i></a><p>&copy; Copyright 2017 &middot; The Egel's Blog &middot; The <a href="https://en.wikipedia.org/wiki/KISS_principle" title="Keep it stupid simple" target="_blank">KISS</a> Principle &middot; Build with <a href="http://docs.getpelican.com/" target="_blank">pelican</a>. </p></div></div></div></footer><script src="./theme/js/egelance_pelican_theme-v2.0.0.js"></script><script type="text/javascript">var addthis_config = {"data_track_addressbar": true};</script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=True"></script></div></div></body></html>